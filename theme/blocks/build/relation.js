!function(){"use strict";function e(){return e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},e.apply(this,arguments)}var t=window.wp.element,a=window.wp.blocks,r=window.wp.blockEditor,n=window.wp.components;function l(e){const{href:a="",blank:r=!1,mode:n="link",className:l="",target:s="",sponsored:c=!1,children:o}=e;if(r)switch(n){case"link":return(0,t.createElement)("a",{className:l,href:a,target:"_blank",rel:"noopener noreferrer"+(c?" sponsored":""),"data-target":s},o);case"mail":return(0,t.createElement)("a",{className:l,href:`mailto:${a}`,target:"_blank",rel:"noopener noreferrer"+(c?" sponsored":""),"data-target":s},o);case"tel":return(0,t.createElement)("a",{className:l,href:`tel:${a}`,target:"_blank",rel:"noopener noreferrer"+(c?" sponsored":""),"data-target":s},o);case"download":return(0,t.createElement)("a",{className:l,href:a,download:!0,target:"_blank",rel:"noopener noreferrer"+(c?" sponsored":""),"data-target":s},o)}else if(c)switch(n){case"link":return(0,t.createElement)("a",{className:l,href:a,"data-target":s,rel:"sponsored noreferrer"},o);case"mail":return(0,t.createElement)("a",{className:l,href:`mailto:${a}`,"data-target":s,rel:"sponsored noreferrer"},o);case"tel":return(0,t.createElement)("a",{className:l,href:`tel:${a}`,"data-target":s,rel:"sponsored noreferrer"},o);case"download":return(0,t.createElement)("a",{className:l,href:a,download:!0,"data-target":s,rel:"sponsored noreferrer"},o)}else switch(n){case"link":return(0,t.createElement)("a",{className:l,href:a,"data-target":s},o);case"mail":return(0,t.createElement)("a",{className:l,href:`mailto:${a}`,"data-target":s},o);case"tel":return(0,t.createElement)("a",{className:l,href:`tel:${a}`,"data-target":s},o);case"download":return(0,t.createElement)("a",{className:l,href:a,download:!0,"data-target":s},o)}}window.React,(0,a.registerBlockType)("theme/relation",{title:"記事リンク",icon:"admin-site",category:"layout",attributes:{href:{type:"string",default:""},data:{type:"object",default:null},blank:{type:"boolean",default:!1},err:{type:"string",default:""}},edit(e){const{className:a,attributes:{href:l,data:s,blank:c,err:o},setAttributes:i}=e,m=a.replace(/\s.+?$/,"");return(0,t.createElement)("div",{className:a},(0,t.createElement)("div",{className:`${m}__input`},(0,t.createElement)(r.URLInput,{onChange:e=>i({href:e}),value:l,className:`${m}__url`}),(0,t.createElement)(n.ToggleControl,{label:"新しいタブで開く",checked:c,onChange:()=>i({blank:!c})}),(0,t.createElement)(n.Button,{onClick:()=>{l.match(/https?:\/\/[-_.!~*\'()a-zA-Z0-9;\/?:\@&=+\$,%#\u3000-\u30FE\u4E00-\u9FA0\uFF01-\uFFE3]+/g)?fetch("/wp-json/api/v1/relation/?url="+encodeURIComponent(l),{method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"}}).then((e=>{if(!e.ok)throw new Error;return e.json()})).then((e=>{const t=JSON.parse(e);i({data:{description:t.description,image:t.image,title:t.title},err:""})})).catch((e=>{i({data:null,err:"エラー：URLが無効か、対象のHTMLデータが不完全な可能性があります"})})):i({data:null,err:"エラー：URLの形式に誤りがあります"})},isPrimary:!0},"データを取得")),o&&(0,t.createElement)("div",{className:`${m}__error`},o),!o&&s&&(()=>{const{title:e,image:a,description:r}=s;return(0,t.createElement)("div",{className:`${m}__content`},(0,t.createElement)("div",{className:`${m}__thumb`},(0,t.createElement)("picture",{className:`${m}__picture`},(0,t.createElement)("img",{src:a,alt:e,className:`${m}__image`}))),(0,t.createElement)("div",{className:`${m}__data`},(0,t.createElement)("div",{className:`${m}__title`},e),(0,t.createElement)("div",{className:`${m}__description`},r)))})())},save(a){const{className:r="wp-block-theme-relation",attributes:{href:n,data:s,blank:c,err:o}}=a,i=r.replace(/\s.+?$/,"");return(0,t.createElement)(t.Fragment,null,!o&&s&&(()=>{const{title:r,image:n,description:c}=s;return(0,t.createElement)(l,e({},a.attributes,{className:`${i}__link`}),(0,t.createElement)("div",{className:`${i}__thumb`},(0,t.createElement)("picture",{className:`${i}__picture`},(0,t.createElement)("img",{src:n,alt:r,className:`${i}__image`}))),(0,t.createElement)("div",{className:`${i}__data`},(0,t.createElement)("div",{className:`${i}__title`},r),(0,t.createElement)("div",{className:`${i}__description`},c)))})())}})}();